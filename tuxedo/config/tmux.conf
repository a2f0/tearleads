# Tuxedo tmux configuration
set -g default-command "${SHELL} -l"
set -g default-terminal "tmux-256color"
set -ga terminal-overrides ",tmux-256color:Tc,screen-256color:Tc,xterm-256color:Tc,xterm-ghostty:Tc,ghostty:Tc"
set-environment -g COLORTERM truecolor
setw -g mode-keys vi
set -g allow-rename off
set -g automatic-rename off

# Top status bar (main navigation)
set -g status on
set-option -g status-position top
set -g status-interval 60

# Bottom status bar using pane border
set -g pane-border-status bottom
set -g pane-border-format '#[fg=#bb9af7]#(basename "#{pane_current_path}")#[fg=#565f89]:#[fg=#9ece6a]#(cd "#{pane_current_path}"; git rev-parse --abbrev-ref HEAD 2>/dev/null) '

# Tokyo Night color palette
set -g status-style "bg=#1a1b26,fg=#c0caf5"
set -g status-left "#[fg=#7aa2f7,bold][#S] "
set -g status-left-length 30
set -g status-right ""

# Window status styling (Top bar)
set -g window-status-style "bg=#1a1b26,fg=#565f89"
set -g window-status-current-style "bg=#1a1b26,fg=#7dcfff,bold"
set -g window-status-format ' #W-#(cd "#{pane_current_path}"; git rev-parse --abbrev-ref HEAD 2>/dev/null) '
set -g window-status-current-format ' #W-#(cd "#{pane_current_path}"; git rev-parse --abbrev-ref HEAD 2>/dev/null) '
set -g window-status-separator "  "

# Pane border styling
set -g pane-border-style "fg=#3b4261"
set -g pane-active-border-style "fg=#7aa2f7"

# Message styling
set -g message-style "bg=#1a1b26,fg=#7aa2f7"

# Mouse support
set -g mouse on
bind -n MouseDown1Pane select-pane -t= \; send-keys -M
bind -n MouseDrag1Pane if-shell -F "#{||:#{pane_in_mode},#{&&:#{alternate_on},#{!=:#{m/r:^screen,#{pane_current_command}},1}}}" { send-keys -M } { copy-mode -M }

# Custom right-click menu with screen splits instead of tmux splits
bind -n MouseDown3Pane display-menu -T "#[align=centre]Screen Splits" -t = -x M -y M \
    "Horizontal Split (screen)" h { send-keys C-a - } \
    "Vertical Split (screen)" v { send-keys C-a \\ } \
    "Close Region" x { send-keys C-a x } \
    "" \
    "Copy Word" c { copy-mode -q ; set-buffer "#{q:mouse_word}" } \
    "Copy Line" l { copy-mode -q ; set-buffer "#{q:mouse_line}" }

# Keybindings
bind -n C-t new-window -c "#{pane_current_path}"
# Screen region splits (sends Ctrl-a - for horizontal, Ctrl-a \ for vertical)
bind '"' send-keys C-a -
bind % send-keys C-a \\
# S-Left/S-Right pass through to screen for region navigation (no tmux binding)
bind-key -n M-Left previous-window \; select-pane -t 0
bind-key -n M-Right next-window \; select-pane -t 0
bind-key -n C-r run-shell 'tmux source-file "${TUXEDO_TMUX_CONF:-$HOME/.tmux.conf}" && tmux display-message "Config reloaded"'
bind-key -n C-k clear-history \; send-keys clear Enter
bind-key -n C-g new-window -n "gemini" -c "#{pane_current_path}" "gemini"

# History and Scrolling
set -g history-limit 2000
set -g aggressive-resize on
bind -T copy-mode-vi WheelUpPane send-keys -X -N 3 scroll-up
bind -T copy-mode-vi WheelDownPane send-keys -X -N 3 scroll-down
bind -T copy-mode-vi MouseDragEnd1Pane send-keys -X copy-selection-and-cancel
