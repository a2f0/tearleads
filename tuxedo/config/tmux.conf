# Tuxedo tmux configuration
set -g default-command "${SHELL} -l"
set -g default-terminal "tmux-256color"
set -ga terminal-overrides ",tmux-256color:Tc,screen-256color:Tc,xterm-256color:Tc,xterm-ghostty:Tc,ghostty:Tc"
set-environment -g COLORTERM truecolor
setw -g mode-keys vi

# Enable OSC 52 clipboard passthrough (allows nested apps to copy to system clipboard)
set -s set-clipboard on
set -g allow-rename off
set -g automatic-rename off

# Top status bar (main navigation)
set -g status on
set-option -g status-position top
set -g status-interval 60

# Bottom status bar using pane border
set -g pane-border-status bottom
set -g pane-border-format '#[fg=#bb9af7]#(basename "#{pane_current_path}")#[fg=#565f89]:#[fg=#9ece6a]#(cd "#{pane_current_path}"; git rev-parse --abbrev-ref HEAD 2>/dev/null) '

# Tokyo Night color palette
set -g status-style "bg=#1a1b26,fg=#c0caf5"
set -g status-left "#[fg=#7aa2f7,bold][#S] "
set -g status-left-length 30
set -g status-right ""

# Window status styling (Top bar)
set -g window-status-style "bg=#1a1b26,fg=#565f89"
set -g window-status-current-style "bg=#1a1b26,fg=#7dcfff,bold"
set -g window-status-format ' #W '
set -g window-status-current-format ' #W '
set -g window-status-separator "  "

# Pane border styling
set -g pane-border-style "fg=#3b4261"
set -g pane-active-border-style "fg=#7aa2f7"
set -g pane-border-lines heavy
set -g pane-border-indicators arrows

# Dim inactive panes for clear focus indication
set -g window-style "bg=#16161e"
set -g window-active-style "bg=#1a1b26"

# Message styling
set -g message-style "bg=#1a1b26,fg=#7aa2f7"

# Mouse support - pass through to inner tmux for pane-isolated selection
set -g mouse on
bind -n MouseDrag1Pane send-keys -M
bind -n MouseDragEnd1Pane send-keys -M
bind -n MouseDown1Pane select-pane -t = \; send-keys -M

# Custom right-click menu with inner tmux splits
bind -n MouseDown3Pane display-menu -T "#[align=centre]Pane Splits" -t = -x M -y M \
    "Horizontal Split" h { send-keys C-a - } \
    "Vertical Split" v { send-keys C-a \\ } \
    "Even Rows" e { send-keys C-a M-2 } \
    "Even Columns" E { send-keys C-a M-1 } \
    "Close Pane" x { send-keys C-a x } \
    "" \
    "Copy Word" c { copy-mode -q ; set-buffer "#{q:mouse_word}" } \
    "Copy Line" l { copy-mode -q ; set-buffer "#{q:mouse_line}" }

# Keybindings
bind -n C-t new-window -c "#{pane_current_path}"
# Inner tmux splits (sends Ctrl-a - for horizontal, Ctrl-a \ for vertical)
bind '"' send-keys C-a -
bind % send-keys C-a \\
# S-Left/S-Right pass through to inner tmux for pane navigation (no outer binding)
bind-key -n M-Left previous-window \; select-pane -t 0
bind-key -n M-Right next-window \; select-pane -t 0
bind-key -n C-r run-shell 'tmux source-file "${TUXEDO_TMUX_CONF:-$HOME/.tmux.conf}" && tmux display-message "Config reloaded"'
bind-key -n C-k clear-history \; send-keys clear Enter
bind-key -n C-g new-window -n "gemini" -c "#{pane_current_path}" "gemini"

# History and Scrolling - pass through to inner tmux
set -g history-limit 2000
set -g aggressive-resize on
# Mouse events pass through to inner tmux (or application) for scrolling
bind -T copy-mode-vi WheelUpPane send-keys -X -N 3 scroll-up
bind -T copy-mode-vi WheelDownPane send-keys -X -N 3 scroll-down
bind -T copy-mode-vi MouseDragEnd1Pane send-keys -X copy-selection-and-cancel
