# Inner tmux configuration for tuxedo workspaces
# Runs inside outer tmux, handles shell/editor splits

# Use Ctrl-a as prefix (outer tmux uses Ctrl-b)
set -g prefix C-a
unbind C-b
bind C-a send-prefix

# Terminal settings - prepend workspace scripts to PATH before starting shell
set -g default-command 'sh -c "[ -n \"$TUXEDO_WORKSPACE\" ] && export PATH=\"$TUXEDO_WORKSPACE/scripts:$TUXEDO_WORKSPACE/scripts/agents:$PATH\"; exec ${SHELL} -l"'
set -g default-terminal "tmux-256color"
set -ga terminal-overrides ",tmux-256color:Tc,screen-256color:Tc,xterm-256color:Tc,xterm-ghostty:Tc,ghostty:Tc"
set-environment -g COLORTERM truecolor
setw -g mode-keys vi

# Enable OSC 52 clipboard (allows apps like neovim to copy to system clipboard)
set -s set-clipboard on

# No status bar - outer tmux handles that
set -g status off

# Pane border styling (subtle since we're nested)
set -g pane-border-style "fg=#3b4261"
set -g pane-active-border-style "fg=#7aa2f7"
set -g pane-border-status off
set -g pane-border-lines heavy
set -g pane-border-indicators arrows

# Dim inactive panes for clear focus indication
set -g window-style "bg=#16161e"
set -g window-active-style "bg=#1a1b26"

# Mouse support - neovim handles its own selection (auto-yank), terminal uses tmux copy-mode
set -g mouse on
bind -n MouseDown1Pane select-pane -t = \; send-keys -M
bind -n MouseDrag1Pane if-shell -F "#{mouse_any_flag}" "send-keys -M" "copy-mode -M"
bind -T copy-mode-vi MouseDragEnd1Pane send-keys -X copy-pipe-and-cancel "pbcopy"
bind -T copy-mode-vi y send-keys -X copy-pipe-and-cancel "pbcopy"

# Pane navigation with Shift+Left/Right
bind -n S-Left select-pane -t :.-
bind -n S-Right select-pane -t :.+

# Splits inherit current path
bind '"' split-window -v -c "#{pane_current_path}"
bind % split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"
bind \\ split-window -h -c "#{pane_current_path}"

# Close pane
bind x kill-pane

# Reload config
bind r source-file "$TUXEDO_INNER_CONF" \; display-message "Inner config reloaded"

# History and Scrolling
set -g history-limit 10000
bind -T copy-mode-vi WheelUpPane send-keys -X -N 3 scroll-up
bind -T copy-mode-vi WheelDownPane send-keys -X -N 3 scroll-down
