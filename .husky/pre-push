set -e

./scripts/checkNodeVersion.sh

./scripts/checkBinaryFiles.sh --from-upstream
./scripts/preen/checkJs.sh --from-upstream
./scripts/checkPreenEcosystem.sh --strict
./scripts/preen/checkCircularImports.sh
./scripts/checkTerraform.sh

pnpm exec tsx scripts/ciImpact/runImpactedQuality.ts --base origin/main --head HEAD

# Run impacted package coverage tests with conservative full-run fallback.
pnpm exec tsx scripts/ciImpact/runImpactedTests.ts --base origin/main --head HEAD
