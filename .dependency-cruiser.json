{
  "$schema": "https://unpkg.com/dependency-cruiser/config.schema.json",
  "forbidden": [
    {
      "name": "no-circular",
      "severity": "error",
      "comment": "Disallow circular dependencies in package source trees.",
      "from": {
        "path": "^packages/[^/]+/src",
        "pathNot": "(\\.test|\\.spec)\\.(ts|tsx)$|/src/test/|/src/__tests__/"
      },
      "to": {
        "circular": true
      }
    },
    {
      "name": "no-api-imports",
      "severity": "error",
      "comment": "Packages must not depend on api app internals.",
      "from": {
        "path": "^packages/(?!api/)[^/]+/src",
        "pathNot": "(\\.test|\\.spec)\\.(ts|tsx)$|/src/test/|/src/__tests__/"
      },
      "to": {
        "path": "^packages/api/src"
      }
    },
    {
      "name": "no-client-imports",
      "severity": "error",
      "comment": "Shared code should not depend on client app internals.",
      "from": {
        "path": "^packages/(?!client/)[^/]+/src",
        "pathNot": "(\\.test|\\.spec)\\.(ts|tsx)$|/src/test/|/src/__tests__/"
      },
      "to": {
        "path": "^packages/client/src"
      }
    },
    {
      "name": "no-client-local-cross-package-src-imports",
      "severity": "error",
      "comment": "Client code should import other packages via package exports, not relative paths into another package's src tree.",
      "from": {
        "path": "^packages/client/src",
        "pathNot": "(\\.test|\\.spec)\\.(ts|tsx)$|/src/test/|/src/__tests__/"
      },
      "to": {
        "path": "^packages/(?!client/)[^/]+/src",
        "dependencyTypes": [
          "local"
        ]
      }
    },
    {
      "name": "no-cross-package-non-entrypoint-imports",
      "severity": "warn",
      "comment": "Packages should import other packages through public entrypoints, not non-index source internals.",
      "from": {
        "path": "^packages/[^/]+/src",
        "pathNot": "(\\.test|\\.spec)\\.(ts|tsx)$|/src/test/|/src/__tests__/"
      },
      "to": {
        "path": "^packages/[^/]+/src/(?!index\\.(ts|tsx)$).*",
        "dependencyTypes": [
          "undetermined",
          "npm",
          "npm-dev",
          "npm-peer",
          "aliased"
        ]
      }
    },
    {
      "name": "no-local-app-builder-vite-plugin-imports",
      "severity": "error",
      "comment": "Packages should consume app-builder vite helpers via package exports instead of local imports into app-builder/src internals.",
      "from": {
        "path": "^packages/(?!app-builder/)[^/]+/(src/.*|vitest\\.config\\.ts|vite\\.config\\.ts)$",
        "pathNot": "(\\.test|\\.spec)\\.(ts|tsx)$|/src/test/|/src/__tests__/"
      },
      "to": {
        "path": "^packages/app-builder/src/vite/createAppConfigPlugin\\.ts$",
        "dependencyTypes": [
          "local"
        ]
      }
    },
    {
      "name": "no-prod-to-test-imports",
      "severity": "error",
      "comment": "Production modules must not import test-only modules or test support helpers.",
      "from": {
        "path": "^packages/[^/]+/src",
        "pathNot": "(\\.test|\\.spec)\\.(ts|tsx)$|/src/test/|/src/__tests__/"
      },
      "to": {
        "path": "(\\.test|\\.spec)\\.(ts|tsx)$|/src/test/|/src/__tests__/|/testSupport\\.(ts|tsx)$"
      }
    },
    {
      "name": "no-local-cross-package-app-src-imports",
      "severity": "error",
      "comment": "Packages should not traverse into other package app/src internals via relative local imports; use package exports.",
      "from": {
        "path": "^packages/(?!admin/|app-builder/|keychain/|notifications/|vfs-sync/|wallet/)[^/]+/src",
        "pathNot": "(\\.test|\\.spec)\\.(ts|tsx)$|/src/test/|/src/__tests__/"
      },
      "to": {
        "path": "^packages/(admin|app-builder|keychain|notifications|vfs-sync|wallet)/src",
        "dependencyTypes": [
          "local"
        ]
      }
    },
    {
      "name": "no-website-imports",
      "severity": "error",
      "comment": "Non-website packages should not import website app internals.",
      "from": {
        "path": "^packages/(?!website/)[^/]+/src",
        "pathNot": "(\\.test|\\.spec)\\.(ts|tsx)$|/src/test/|/src/__tests__/"
      },
      "to": {
        "path": "^packages/website/src"
      }
    },
    {
      "name": "no-chrome-extension-imports",
      "severity": "error",
      "comment": "Non-extension packages should not import chrome-extension app internals.",
      "from": {
        "path": "^packages/(?!chrome-extension/)[^/]+/src",
        "pathNot": "(\\.test|\\.spec)\\.(ts|tsx)$|/src/test/|/src/__tests__/"
      },
      "to": {
        "path": "^packages/chrome-extension/src"
      }
    },
    {
      "name": "no-smtp-listener-imports",
      "severity": "error",
      "comment": "Non-smtp-listener packages should not import smtp-listener app internals.",
      "from": {
        "path": "^packages/(?!smtp-listener/)[^/]+/src",
        "pathNot": "(\\.test|\\.spec)\\.(ts|tsx)$|/src/test/|/src/__tests__/"
      },
      "to": {
        "path": "^packages/smtp-listener/src"
      }
    }
  ],
  "options": {
    "tsConfig": {
      "fileName": "tsconfig.json"
    },
    "tsPreCompilationDeps": true,
    "doNotFollow": {
      "path": "(^|/)node_modules/|(\\.test|\\.spec)\\.(ts|tsx)$|/src/test/|/src/__tests__/"
    },
    "enhancedResolveOptions": {
      "extensions": [
        ".ts",
        ".tsx",
        ".mts",
        ".js",
        ".jsx",
        ".mjs",
        ".cjs",
        ".json"
      ]
    },
    "reporterOptions": {
      "dot": {
        "collapsePattern": "^packages/[^/]+/src"
      }
    }
  }
}
