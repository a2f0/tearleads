{
  "$schema": "https://unpkg.com/dependency-cruiser/config.schema.json",
  "forbidden": [
    {
      "name": "no-circular",
      "severity": "error",
      "comment": "Disallow circular dependencies in package source trees.",
      "from": {
        "path": "^packages/[^/]+/src"
      },
      "to": {
        "circular": true
      }
    },
    {
      "name": "no-api-imports",
      "severity": "error",
      "comment": "Packages must not depend on api app internals.",
      "from": {
        "path": "^packages/(?!api/)[^/]+/src"
      },
      "to": {
        "path": "^packages/api/src"
      }
    },
    {
      "name": "no-client-imports",
      "severity": "error",
      "comment": "Shared code should not depend on client app internals.",
      "from": {
        "path": "^packages/(?!client/)[^/]+/src"
      },
      "to": {
        "path": "^packages/client/src"
      }
    },
    {
      "name": "no-client-local-cross-package-src-imports",
      "severity": "error",
      "comment": "Client code should import other packages via package exports, not relative paths into another package's src tree.",
      "from": {
        "path": "^packages/client/src"
      },
      "to": {
        "path": "^packages/(?!client/)[^/]+/src",
        "dependencyTypes": [
          "local"
        ]
      }
    },
    {
      "name": "no-cross-package-non-entrypoint-imports",
      "severity": "error",
      "comment": "Packages should import other packages through public entrypoints, not non-entrypoint source internals.",
      "from": {
        "path": "^packages/([^/]+)/src"
      },
      "to": {
        "path": "^packages/[^/]+/src/(?!(index|clientEntry)\\.(ts|tsx)$).*",
        "pathNot": "^packages/\\1/src/.*",
        "dependencyTypes": [
          "undetermined",
          "npm",
          "npm-dev",
          "npm-peer",
          "aliased"
        ]
      }
    },
    {
      "name": "no-cross-package-src-entrypoint-imports",
      "severity": "error",
      "comment": "Packages should import other packages through package roots, not direct src/index entrypoints. Remaining hotspot files are allowlisted for incremental cleanup.",
      "from": {
        "path": "^packages/([^/]+)/src/.*",
        "pathNot": [
          "^packages/client/src/contexts/ClientVfsExplorerProvider\\.tsx$",
          "^packages/client/src/contexts/VfsOrchestratorContext\\.tsx$",
          "^packages/client/src/db/vfsOrchestratorState\\.ts$",
          "^packages/client/src/lib/vfsItemSyncWriter\\.ts$"
        ]
      },
      "to": {
        "path": "^packages/[^/]+/src/index\\.(ts|tsx)$",
        "pathNot": "^packages/\\1/src/.*",
        "dependencyTypes": [
          "undetermined",
          "npm",
          "npm-dev",
          "npm-peer",
          "aliased"
        ]
      }
    },
    {
      "name": "no-local-app-builder-vite-plugin-imports",
      "severity": "error",
      "comment": "Packages should consume app-builder vite helpers via package exports instead of local imports into app-builder/src internals.",
      "from": {
        "path": "^packages/(?!app-builder/)[^/]+/(src/.*|vitest\\.config\\.ts|vite\\.config\\.ts)$"
      },
      "to": {
        "path": "^packages/app-builder/src/vite/createAppConfigPlugin\\.ts$",
        "dependencyTypes": [
          "local"
        ]
      }
    },
    {
      "name": "no-prod-to-test-imports",
      "severity": "error",
      "comment": "Production modules must not import test-only modules or test support helpers.",
      "from": {
        "path": "^packages/[^/]+/src"
      },
      "to": {
        "path": "(\\.test|\\.spec)\\.(ts|tsx)$|/src/test/|/src/__tests__/|/testSupport\\.(ts|tsx)$"
      }
    },
    {
      "name": "no-local-cross-package-app-src-imports",
      "severity": "error",
      "comment": "Packages should not traverse into other package app/src internals via relative local imports; use package exports.",
      "from": {
        "path": "^packages/(?!admin/|ai/|analytics/|app-builder/|audio/|businesses/|calendar/|camera/|contacts/|email/|health/|keychain/|mls-chat/|notes/|notifications/|photos/|search/|settings/|terminal/|vfs-explorer/|vfs-sync/|wallet/|window-manager/)[^/]+/src"
      },
      "to": {
        "path": "^packages/(admin|ai|analytics|app-builder|audio|businesses|calendar|camera|contacts|email|health|keychain|mls-chat|notes|notifications|photos|search|settings|terminal|vfs-explorer|vfs-sync|wallet|window-manager)/src",
        "dependencyTypes": [
          "local"
        ]
      }
    },
    {
      "name": "no-website-imports",
      "severity": "error",
      "comment": "Non-website packages should not import website app internals.",
      "from": {
        "path": "^packages/(?!website/)[^/]+/src"
      },
      "to": {
        "path": "^packages/website/src"
      }
    },
    {
      "name": "no-chrome-extension-imports",
      "severity": "error",
      "comment": "Non-extension packages should not import chrome-extension app internals.",
      "from": {
        "path": "^packages/(?!chrome-extension/)[^/]+/src"
      },
      "to": {
        "path": "^packages/chrome-extension/src"
      }
    },
    {
      "name": "no-smtp-listener-imports",
      "severity": "error",
      "comment": "Non-smtp-listener packages should not import smtp-listener app internals.",
      "from": {
        "path": "^packages/(?!smtp-listener/)[^/]+/src"
      },
      "to": {
        "path": "^packages/smtp-listener/src"
      }
    },
    {
      "name": "no-classic-imports",
      "severity": "error",
      "comment": "Non-client packages should not import classic app internals.",
      "from": {
        "path": "^packages/(?!client/|classic/)[^/]+/src"
      },
      "to": {
        "path": "^packages/classic/src"
      }
    },
    {
      "name": "no-cli-imports",
      "severity": "error",
      "comment": "Packages should not import CLI app internals.",
      "from": {
        "path": "^packages/(?!cli/)[^/]+/src"
      },
      "to": {
        "path": "^packages/cli/src"
      }
    },
    {
      "name": "no-tee-api-imports",
      "severity": "error",
      "comment": "Non-tee-api packages should not import tee-api app internals.",
      "from": {
        "path": "^packages/(?!tee-api/)[^/]+/src"
      },
      "to": {
        "path": "^packages/tee-api/src"
      }
    },
    {
      "name": "no-tee-client-imports",
      "severity": "error",
      "comment": "Non-tee-client packages should not import tee-client app internals.",
      "from": {
        "path": "^packages/(?!tee-client/)[^/]+/src"
      },
      "to": {
        "path": "^packages/tee-client/src"
      }
    },
    {
      "name": "no-bob-and-alice-imports",
      "severity": "error",
      "comment": "Non-test packages should not import bob-and-alice test harness internals.",
      "from": {
        "path": "^packages/(?!bob-and-alice/)[^/]+/src"
      },
      "to": {
        "path": "^packages/bob-and-alice/src"
      }
    },
    {
      "name": "no-analytics-imports",
      "severity": "error",
      "comment": "Non-client packages should not import analytics window internals.",
      "from": {
        "path": "^packages/(?!client/|analytics/)[^/]+/src"
      },
      "to": {
        "path": "^packages/analytics/src"
      }
    },
    {
      "name": "no-health-imports",
      "severity": "error",
      "comment": "Non-client packages should not import health window internals.",
      "from": {
        "path": "^packages/(?!client/|health/)[^/]+/src"
      },
      "to": {
        "path": "^packages/health/src"
      }
    },
    {
      "name": "no-client-only-ui-imports",
      "severity": "error",
      "comment": "Client-only UI window packages should only be imported by client, not by other packages.",
      "from": {
        "path": "^packages/(?!client/|audio/|camera/|contacts/|email/|help/|notes/|photos/|vehicles/)[^/]+/src"
      },
      "to": {
        "path": "^packages/(audio|camera|contacts|email|help|notes|photos|vehicles)/src"
      }
    },
    {
      "name": "no-console-imports",
      "severity": "error",
      "comment": "Non-client packages should not import console window internals.",
      "from": {
        "path": "^packages/(?!client/|console/)[^/]+/src"
      },
      "to": {
        "path": "^packages/console/src"
      }
    },
    {
      "name": "no-ai-imports",
      "severity": "error",
      "comment": "Non-client packages should not import ai window internals.",
      "from": {
        "path": "^packages/(?!client/|ai/)[^/]+/src"
      },
      "to": {
        "path": "^packages/ai/src"
      }
    },
    {
      "name": "no-businesses-imports",
      "severity": "error",
      "comment": "Non-client packages should not import businesses window internals.",
      "from": {
        "path": "^packages/(?!client/|businesses/)[^/]+/src"
      },
      "to": {
        "path": "^packages/businesses/src"
      }
    },
    {
      "name": "no-calendar-imports",
      "severity": "error",
      "comment": "Non-client packages should not import calendar window internals.",
      "from": {
        "path": "^packages/(?!client/|calendar/)[^/]+/src"
      },
      "to": {
        "path": "^packages/calendar/src"
      }
    },
    {
      "name": "no-mls-chat-imports",
      "severity": "error",
      "comment": "Non-client packages should not import mls-chat window internals.",
      "from": {
        "path": "^packages/(?!client/|mls-chat/)[^/]+/src"
      },
      "to": {
        "path": "^packages/mls-chat/src"
      }
    },
    {
      "name": "no-search-imports",
      "severity": "error",
      "comment": "Non-client packages should not import search window internals.",
      "from": {
        "path": "^packages/(?!client/|search/)[^/]+/src"
      },
      "to": {
        "path": "^packages/search/src"
      }
    },
    {
      "name": "no-settings-imports",
      "severity": "error",
      "comment": "Non-client packages should not import settings window internals.",
      "from": {
        "path": "^packages/(?!client/|settings/)[^/]+/src"
      },
      "to": {
        "path": "^packages/settings/src"
      }
    },
    {
      "name": "no-terminal-imports",
      "severity": "error",
      "comment": "Non-client packages should not import terminal window internals.",
      "from": {
        "path": "^packages/(?!client/|console/|terminal/)[^/]+/src"
      },
      "to": {
        "path": "^packages/terminal/src"
      }
    },
    {
      "name": "no-vfs-explorer-imports",
      "severity": "error",
      "comment": "Non-client packages should not import vfs-explorer window internals.",
      "from": {
        "path": "^packages/(?!client/|vfs-explorer/)[^/]+/src"
      },
      "to": {
        "path": "^packages/vfs-explorer/src"
      }
    },
    {
      "name": "no-window-manager-imports",
      "severity": "error",
      "comment": "Non-client packages should not import window-manager internals.",
      "from": {
        "path": "^packages/(?!client/|window-manager/)[^/]+/src"
      },
      "to": {
        "path": "^packages/window-manager/src"
      }
    }
  ],
  "options": {
    "tsConfig": {
      "fileName": "tsconfig.json"
    },
    "tsPreCompilationDeps": true,
    "doNotFollow": {
      "path": "(^|/)node_modules/|(\\.test|\\.spec)\\.(ts|tsx)$|/src/test/|/src/__tests__/"
    },
    "enhancedResolveOptions": {
      "extensions": [
        ".ts",
        ".tsx",
        ".mts",
        ".js",
        ".jsx",
        ".mjs",
        ".cjs",
        ".json"
      ]
    },
    "reporterOptions": {
      "dot": {
        "collapsePattern": "^packages/[^/]+/src"
      }
    }
  }
}
