appId: com.tearleads.rapid
---
- launchApp:
    clearState: true

- assertVisible: "Tearleads"

# Navigate to settings with mobile/desktop handling
- evalScript: |
    (async () => {
      window.waitForElement = async (selector, timeout = 8000) => {
        const interval = 200;
        const maxTries = Math.ceil(timeout / interval);
        for (let i = 0; i < maxTries; i++) {
          if (document.querySelector(selector)) return 'ok';
          await new Promise(r => setTimeout(r, interval));
        }
        throw new Error('Element not found: ' + selector);
      };

      const mobileButton = document.querySelector(
        '[data-testid="mobile-menu-button"]'
      );
      if (mobileButton && mobileButton.offsetParent !== null) {
        mobileButton.click();
        await window.waitForElement('[data-testid="mobile-menu-dropdown"]');
        const mobileLink = document.querySelector(
          '[data-testid="mobile-menu-dropdown"] [data-testid="settings-link"]'
        );
        if (!mobileLink) {
          throw new Error('Settings link not found in mobile menu');
        }
        mobileLink.scrollIntoView({ block: 'center' });
        mobileLink.click();
        return 'clicked-mobile';
      }

      const sidebarLink = document.querySelector(
        'aside [data-testid="settings-link"]'
      );
      if (!sidebarLink) {
        throw new Error('Settings link not found in sidebar');
      }
      sidebarLink.scrollIntoView({ block: 'center' });
      sidebarLink.click();
      return 'clicked-sidebar';
    })()

# Wait for Settings page to load (WebView-friendly)
- evalScript: |
    (async () => {
      return window.waitForElement(
        '[data-testid="theme-selector-grid"]',
        10000
      );
    })()

# Tap the dark theme option (starts in light mode by default)
- evalScript: document.querySelector('[data-testid="theme-option-dark"]').click()

# Poll until dark mode is applied
- evalScript: |
    (async () => {
      for (let i = 0; i < 30; i++) {
        if (document.documentElement.classList.contains('dark')) {
          return 'ok';
        }
        await new Promise(resolve => setTimeout(resolve, 100));
      }
      throw new Error('Expected dark mode');
    })()

# Tap light theme option to switch back to light
- evalScript: document.querySelector('[data-testid="theme-option-light"]').click()

# Poll until light mode is applied
- evalScript: |
    (async () => {
      for (let i = 0; i < 30; i++) {
        if (!document.documentElement.classList.contains('dark')) {
          return 'ok';
        }
        await new Promise(resolve => setTimeout(resolve, 100));
      }
      throw new Error('Expected light mode');
    })()
