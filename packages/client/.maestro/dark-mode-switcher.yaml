appId: com.tearleads.rapid
---
- launchApp:
    clearState: true

- assertVisible: "Tearleads"

# Navigate to settings - open mobile menu first if sidebar is not visible
- evalScript: |
    const settingsLink = document.querySelector('[data-testid="settings-link"]');
    if (settingsLink && getComputedStyle(settingsLink).display !== 'none') {
      settingsLink.click();
    } else {
      // Mobile view - open mobile menu first
      const menuButton = document.querySelector('[data-testid="mobile-menu-button"]');
      if (menuButton) menuButton.click();
    }

# If mobile menu was opened, wait for dropdown and click settings
- evalScript: |
    (async () => {
      const settingsLink = document.querySelector('[data-testid="settings-link"]');
      if (settingsLink && getComputedStyle(settingsLink).display !== 'none') {
        // Already navigated or desktop view
        return 'ok';
      }
      // Wait for mobile menu dropdown
      for (let i = 0; i < 20; i++) {
        const mobileSettingsLink = document.querySelector('[data-testid="mobile-menu-dropdown"] [data-testid="settings-link"]');
        if (mobileSettingsLink) {
          mobileSettingsLink.click();
          return 'ok';
        }
        await new Promise(r => setTimeout(r, 100));
      }
      // Fallback - just click any settings-link that exists now
      const anySettingsLink = document.querySelector('[data-testid="settings-link"]');
      if (anySettingsLink) anySettingsLink.click();
      return 'ok';
    })()

# Wait for Settings page to load
- extendedWaitUntil:
    visible: "Settings"
    timeout: 10000

# Tap the dark mode switch (starts in light mode by default)
- evalScript: document.querySelector('[data-testid="dark-mode-switch"]').click()

# Poll until dark mode is applied
- evalScript: |
    (async () => {
      for (let i = 0; i < 30; i++) {
        if (document.documentElement.classList.contains('dark')) {
          return 'ok';
        }
        await new Promise(resolve => setTimeout(resolve, 100));
      }
      throw new Error('Expected dark mode');
    })()

# Tap again to switch back to light
- evalScript: document.querySelector('[data-testid="dark-mode-switch"]').click()

# Poll until light mode is applied
- evalScript: |
    (async () => {
      for (let i = 0; i < 30; i++) {
        if (!document.documentElement.classList.contains('dark')) {
          return 'ok';
        }
        await new Promise(resolve => setTimeout(resolve, 100));
      }
      throw new Error('Expected light mode');
    })()
