appId: com.tearleads.rapid
---
- launchApp:
    clearState: true

# Load shared helpers (provides window.waitFor)
- runFlow: helpers/db-helpers.yaml

# Define file-picker specific helper
- evalScript: |
    window.getChooseFilesBtn = () => {
      return document.querySelector('[data-testid="choose-files-button"]') ||
             Array.from(document.querySelectorAll('button')).find(b =>
               b.textContent.includes('Choose Files') || b.textContent.includes('Open Files App'));
    };
    'helper defined';

# Wait for app to load
- evalScript: |
    window.waitFor(
      () => document.body.innerText.includes('Tearleads'),
      'Tearleads text not found'
    )

# Navigate to Files page by clicking the Files link
- evalScript: |
    window.waitFor(
      () => {
        const filesLink = document.querySelector('[href="/files"]') ||
                          Array.from(document.querySelectorAll('a')).find(a => a.textContent.includes('Files'));
        if (filesLink) {
          filesLink.click();
          return true;
        }
        return false;
      },
      'Files link not found',
      6000
    )

# Wait for Files page to load and the Choose Files button to appear
- evalScript: |
    window.waitFor(
      () => window.getChooseFilesBtn() !== null && window.getChooseFilesBtn() !== undefined,
      'Choose Files button not found'
    )

# Click the Choose Files button (or Open Files App)
- evalScript: |
    window.waitFor(
      () => {
        const btn = window.getChooseFilesBtn();
        if (btn) {
          btn.click();
          return true;
        }
        return false;
      },
      'Choose Files button not found',
      6000
    )
